<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteador</title>
    <link rel="stylesheet" href="css/semantic.min.css">
    <style>
         html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .content {
            flex: 1;
        }
        div > .two{ margin-top: 6em; }
        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 10px 0;
        }
        #jogadores, #jogadoresEscolhidos{
            width: 170px;
            height: 150px;   
            overflow-y: scroll; 
        }
    </style>
</head>
<body>
<div class="content">
    <div class="ui grid">
        <div class="doubling two column row center aligned">
            <div class="column">
                <div class="ui form" style="min-height: 20em; margin: 0 1em 0 1em;">
                    <h4 class="ui dividing header">Gerar times</h4>
                    <div class="ui stackable two column grid">
                        <div class="ten wide column">
                            <div class="ui stackable three grid">
                                <div class="six wide column">
                                    <div class="field">
                                        <label>Jogadores</label>
                                        <select type="text" name="jogadores" id="jogadores" class="ui dropdown" multiple>
                                        </select>
                                    </div>
                                </div>
                                <div class="four wide column" style="padding-top: 7%;">
                                    <div class="ui grid">
                                        <div class="row" style="padding-bottom: 0%;">
                                            <div class="column">
                                                <button id="moveToSelect2" class="ui right icon button">
                                                    <i class="right arrow icon"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="column">
                                                <button id="moveToSelect1" class="ui right icon button">
                                                    <i class="left arrow icon"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="six wide column">
                                    <div class="field">
                                        <label>Jogadores escolhidos</label>
                                        <select type="text" name="jogadoresEscolhidos" id="jogadoresEscolhidos" class="ui dropdown" multiple>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>    
                        <div class="six wide column">
                            <div class="field">
                                <label>Jogadores por time</label>
                                <select type="text" name="jogadoresPorTime" id="jogadoresPorTime" class="ui dropdown">
                                    <option value="">Jogadores por time</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                </select>
                            </div>
                        </div>
                    <div class="column centered row">
                        <button class="ui submit button" id="btnGerarID">Gerar</button>
                    </div>
                    </div>
                </div>
            </div>
            <div class="column">
                <div style="margin: 0 1em 0 1em;">
                    <h4 class="ui dividing header">Times</h4>
                    <div style="min-height: 20em;">
                        <div id="resultadoID" class="ui stackable four column grid centered"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<footer>
    <div>
        <p>Daniel Rodrigues Alves. Todos os direitos reservados.</p>
    </div>
</footer>
</body>
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script src="js/semantic.min.js"></script>
<script>
$(document).ready(function() {
    verificarCondicoes('#jogadoresEscolhidos', '#jogadoresPorTime');
    $('#jogadoresEscolhidos, #jogadoresPorTime').on('change input', function() {
        verificarCondicoes('#jogadoresEscolhidos', '#jogadoresPorTime');
    });

    let meuSelect = document.getElementById('jogadores');
    let jogadores = ['Daniel Rodrigues', 'Diogo Santos', 'Davi Araújo', 'Vitor Nascimento', 'Manassés Mota', 'Cayllo Rodrigo', 'Bruno Paiva', 'Natan', 'Gustavo', 'Léo', 'Thiago', 'Milton', 'Douglas', 'Levi'];
    
    jogadores.forEach(jogador => {
        let jogadorElement = document.createElement('option');
        
        jogadorElement.value = jogador.toUpperCase();
        jogadorElement.textContent = jogador;
        
        meuSelect.appendChild(jogadorElement);
    });

    $('#moveToSelect2').click(function() {
        $('#jogadores option:selected').each(function() {
            $(this).appendTo('#jogadoresEscolhidos');
        });
        verificarCondicoes('#jogadoresEscolhidos', '#jogadoresPorTime');
    });

    $('#moveToSelect1').click(function() {
        $('#jogadoresEscolhidos option:selected').each(function() {
            $(this).appendTo('#jogadores');
        });
        verificarCondicoes('#jogadoresEscolhidos', '#jogadoresPorTime');
    });

    $('#jogadoresPorTime').dropdown();
    
    $('#jogadoresPorTime').on('input', function(){
        this.value = this.value.replace(/[^2345]/g, '');
        if (this.value.length > 1) {
            this.value = this.value.charAt(0); // Mantém apenas o primeiro caractere
        }
    });

    $('#btnGerarID').click(function(){
        let jogadoresEscolhidos = document.getElementById('jogadoresEscolhidos');
        let jogadoresPorTime = parseInt(document.getElementById('jogadoresPorTime').value, 10);
        let resultado = document.getElementById('resultadoID');
        if(resultado.innerHTML.trim() !== ''){resultado.innerHTML = '';}
        let selectedValues = [];

        for (let option of jogadoresEscolhidos.options) {
            selectedValues.push(option.value);
        }
        
        const mapTimes = new Map();

        const quantidadeGrupos = Math.ceil(selectedValues.length / jogadoresPorTime);
        for (let i = 0; i < quantidadeGrupos; i++) {
            const listaParticipantes = [];
            let nomeAle;

            for (let j = 0; j < jogadoresPorTime; j++) {
                if (selectedValues.length === 0) break;
                nomeAle = selectedValues[Math.floor(Math.random()*selectedValues.length)];

                selectedValues = selectedValues.filter(nome => nome !== nomeAle);

                listaParticipantes.push(nomeAle);
            }

            // Verifica se é o último time
            const key = (i === quantidadeGrupos - 1 && listaParticipantes.length < jogadoresPorTime) ? 
            'TIME DE FORA' : `TIME ${i + 1}`;

            mapTimes.set(key, listaParticipantes);
        }

        mapTimes.forEach((time, key) => {
            resultado.innerHTML += `
            <div class="column">
                <table class="ui red table">
                    <thead>
                        <tr>
                            <th>${key}</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${time.map(jogador =>`
                            <tr>
                                <td>${jogador}</td>
                            </tr>`).join('')}
                    </tbody>
                </table>
            </div>`;
        });
    });   
});

function verificarCondicoes(participantes, quantidadeJ) {
    let totalOptionsDisponiveis = $(participantes).find('option').length;
    let jogadoresPorTime = $(quantidadeJ).val();

    if (totalOptionsDisponiveis >= 2 && jogadoresPorTime ) {
        $('#btnGerarID').prop('disabled', false);
    } else {
        $('#btnGerarID').prop('disabled', true);
    }
}
</script>
</html>